<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Tens Mine</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    text-align: center;
    padding: 20px;
  }
  h1 {
    margin-bottom: 10px;
  }
  #package-selection button {
    margin: 10px;
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background-color: #444;
    color: #eee;
  }
  #status {
    margin: 15px 0;
    font-size: 18px;
  }
  #game-board {
    margin: 20px auto;
    width: max-content;
    position: relative;
    display: grid;
    grid-template-columns: repeat(5, 80px);
    grid-template-rows: repeat(4, 80px);
    gap: 10px;
  }
  .square {
    width: 80px;
    height: 80px;
    background-color: #333;
    border-radius: 8px;
    font-size: 36px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    color: #fff;
  }
  .revealed-token {
    background-color: #2a8;
  }
  .revealed-bomb {
    background-color: #b33;
  }
  #explosion {
    position: absolute;
    width: 160px;
    height: 160px;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 5;
    display: none;
    pointer-events: none;
  }
  #message {
    font-size: 18px;
    min-height: 30px;
    margin-top: 10px;
  }
  #cashout-btn {
    margin-top: 20px;
    padding: 10px 25px;
    font-size: 16px;
    background: #2a8;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    display: none;
  }
</style>
</head>
<body>

<h1>Tens Mine</h1>

<div id="package-selection">
  <button data-package="silver">Silver (5 tokens)</button>
  <button data-package="gold">Gold (10 tokens)</button>
  <button data-package="platinum">Platinum (20 tokens)</button>
</div>

<div id="status">
  Tokens: <span id="tokens">0</span> |
  Cash: $<span id="cash">0.00</span>
</div>

<div id="game-board"></div>

<img id="explosion" src="data:image/gif;base64,R0lGODlhIAAgAPQAAP///wAAAMLCwv///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAAAAAAALAAAAAAgACAAAAVTICSOZGmeaKqubOu+cCzPdFSCXBsGiGIGgSIaAcHKEECS4mh0MBpEIEwVImEdqkq6vOK9p98YQgUAOw==" alt="Explosion" />

<audio id="explosion-sound" preload="auto">
  <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_b8c2091e9a.mp3" type="audio/mpeg">
</audio>

<div id="message">Buy a package to begin!</div>

<button id="cashout-btn">Cash Out</button>

<script>
(() => {
  const gameBoard = document.getElementById('game-board');
  const tokensDisplay = document.getElementById('tokens');
  const cashDisplay = document.getElementById('cash');
  const message = document.getElementById('message');
  const explosion = document.getElementById('explosion');
  const explosionSound = document.getElementById('explosion-sound');
  const cashoutBtn = document.getElementById('cashout-btn');

  const packages = {
    silver: 5,
    gold: 10,
    platinum: 20,
  };

  const tokenValue = 0.10;
  const maxTokensPerRound = 3;
  const gridSize = 20;

  let tokens = 0;
  let cash = 0;
  let currentTokensThisRound = 0;
  let gameActive = false;

  function updateDisplay() {
    tokensDisplay.textContent = tokens;
    cashDisplay.textContent = cash.toFixed(2);
  }

  function generateBoard() {
    gameBoard.innerHTML = "";
    let board = [];

    const tokenIndices = new Set();
    while (tokenIndices.size < maxTokensPerRound) {
      tokenIndices.add(Math.floor(Math.random() * gridSize));
    }

    for (let i = 0; i < gridSize; i++) {
      const type = tokenIndices.has(i) ? 'token' : 'bomb';
      const div = document.createElement('div');
      div.classList.add('square');
      div.dataset.type = type;
      div.addEventListener('click', handleSquareClick, { once: true });
      gameBoard.appendChild(div);
    }
  }

  function handleSquareClick(e) {
    if (!gameActive || tokens <= 0) return;

    const sq = e.target;
    const type = sq.dataset.type;

    if (type === 'token') {
      sq.classList.add('revealed-token');
      sq.textContent = 'ðŸ’°';
      tokens--;
      cash += tokenValue;
      currentTokensThisRound++;

      message.textContent = `You found a token! (${currentTokensThisRound} this round)`;

      if (currentTokensThisRound === maxTokensPerRound) {
        message.textContent = "Max tokens found this round. You can cash out or buy another package.";
        gameActive = false;
        cashoutBtn.style.display = 'inline-block';
      }
    } else {
      sq.classList.add('revealed-bomb');
      sq.textContent = 'ðŸ’¥';
      message.textContent = "BOOM! You hit a bomb! All progress lost.";
      showExplosion();
      playExplosionSound();
      resetRound();
    }

    updateDisplay();
  }

  function showExplosion() {
    explosion.style.display = 'block';
    setTimeout(() => {
      explosion.style.display = 'none';
    }, 2000);
  }

  function playExplosionSound() {
    explosionSound.pause();
    explosionSound.currentTime = 0;
    explosionSound.play().catch(e => console.log("Audio play blocked:", e));
  }

  function resetRound() {
    currentTokensThisRound = 0;
    tokens = 0;
    gameActive = false;
    cashoutBtn.style.display = 'none';
  }

  function startGame(packageType) {
    tokens = packages[packageType];
    currentTokensThisRound = 0;
    gameActive = true;
    cashoutBtn.style.display = 'none';
    message.textContent = "Game started! Click squares.";
    updateDisplay();
    generateBoard();
  }

  function cashOut() {
    alert(`You cashed out $${cash.toFixed(2)}!`);
    cash = 0;
    updateDisplay();
    gameBoard.innerHTML = "";
    message.textContent = "Buy a new package to play again.";
    cashoutBtn.style.display = 'none';
  }

  document.getElementById('package-selection').addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON') {
      const pkg = e.target.dataset.package;
      startGame(pkg);
    }
  });

  cashoutBtn.addEventListener('click', cashOut);

  updateDisplay();
})();
</script>
</body>
</html>
