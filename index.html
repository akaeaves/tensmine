<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tens Mine</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #111;
      color: #fff;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(5, 80px);
      grid-gap: 10px;
      justify-content: center;
      margin-top: 20px;
    }
    .cell {
      width: 80px;
      height: 80px;
      background-color: #444;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      cursor: pointer;
      user-select: none;
    }
    .disabled {
      pointer-events: none;
      opacity: 0.6;
    }
    .info {
      margin-top: 20px;
    }
    .explosion {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 400px;
      z-index: 999;
      display: none;
    }
    .cashout-popup {
      position: fixed;
      top: 30%;
      left: 50%;
      transform: translateX(-50%);
      background: #222;
      padding: 20px;
      border: 2px solid #fff;
      border-radius: 10px;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <h1>Tens Mine</h1>
  <div class="info">
    <p>Tokens: <span id="tokens">0</span> | Cash: $<span id="cash">0.00</span></p>
    <button onclick="buyPackage('silver')">Buy Silver ($0.30 for 3 tokens)</button>
    <button onclick="buyPackage('gold')">Buy Gold ($0.60 for 6 tokens)</button>
    <button onclick="buyPackage('platinum')">Buy Platinum ($1.00 for 10 tokens)</button>
    <button onclick="resetGame()">Reset</button>
  </div>
  <div class="grid" id="grid"></div>
  <img src="https://media.giphy.com/media/xT0xeJpnrWC4XWblEk/giphy.gif" class="explosion" id="explosion" />
  <audio id="boomSound" src="https://www.soundjay.com/explosion/explosion-01.mp3" preload="auto"></audio>
  <div class="cashout-popup" id="cashoutPopup">
    <p>Congratulations! You found 3 tokens!<br>Cashout successful.</p>
    <button onclick="closePopup()">OK</button>
  </div>

  <script>
    const gridEl = document.getElementById("grid");
    const tokenEl = document.getElementById("tokens");
    const cashEl = document.getElementById("cash");
    const explosionEl = document.getElementById("explosion");
    const boomSound = document.getElementById("boomSound");
    const popup = document.getElementById("cashoutPopup");

    let tokens = 0;
    let cash = 0;
    let currentTokensFound = 0;
    let gameOver = false;
    let currentPackage = null;

    const packages = {
      silver: { cost: 0.30, tokens: 3, cashout: 0.50, bombs: 3 },
      gold: { cost: 0.60, tokens: 6, cashout: 0.75, bombs: 3 },
      platinum: { cost: 1.00, tokens: 10, cashout: 1.00, bombs: 2 },
    };

    function updateDisplay() {
      tokenEl.textContent = tokens;
      cashEl.textContent = cash.toFixed(2);
    }

    function buyPackage(type) {
      const pkg = packages[type];
      if (!pkg) return;
      tokens += pkg.tokens;
      currentPackage = pkg;
      startRound();
      updateDisplay();
    }

    function startRound() {
      currentTokensFound = 0;
      gameOver = false;
      explosionEl.style.display = "none";
      popup.style.display = "none";
      gridEl.innerHTML = "";

      const cells = new Array(20).fill("empty");
      const bombIndices = [];

      // Place bombs
      while (bombIndices.length < currentPackage.bombs) {
        let index = Math.floor(Math.random() * 20);
        if (cells[index] === "empty") {
          cells[index] = "bomb";
          bombIndices.push(index);
        }
      }

      // Place token squares (exactly 3)
      let tokenCount = 0;
      while (tokenCount < 3) {
        let index = Math.floor(Math.random() * 20);
        if (cells[index] === "empty") {
          cells[index] = "token";
          tokenCount++;
        }
      }

      // Fill grid
      cells.forEach((type, i) => {
        const div = document.createElement("div");
        div.className = "cell";
        div.addEventListener("click", () => handleClick(type, div));
        gridEl.appendChild(div);
      });

      tokens -= 3; // cost to play a round
      updateDisplay();
    }

    function handleClick(type, div) {
      if (gameOver || div.classList.contains("disabled")) return;
      div.classList.add("disabled");

      if (type === "bomb") {
        div.textContent = "☠";
        explosionEl.style.display = "block";
        boomSound.play();
        gameOver = true;
        cash = 0;
        updateDisplay();
        return;
      }

      if (type === "token") {
        div.textContent = "●";
        currentTokensFound++;
        if (currentTokensFound === 3) {
          cash += currentPackage.cashout;
          popup.style.display = "block";
          gameOver = true;
          updateDisplay();
        }
        return;
      }

      div.textContent = "☠"; // skull symbol for empty
    }

    function resetGame() {
      tokens = 0;
      cash = 0;
      gameOver = false;
      currentTokensFound = 0;
      currentPackage = null;
      gridEl.innerHTML = "";
      updateDisplay();
      explosionEl.style.display = "none";
      popup.style.display = "none";
    }

    function closePopup() {
      popup.style.display = "none";
    }

    resetGame();
  </script>
</body>
</html>
