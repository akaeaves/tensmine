<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Miriele Chatroom</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #0d0d0d;
      color: #fff;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      background-color: #1a1a1a;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }
    header button {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 4px;
    }
    #chat-box {
      flex-grow: 1;
      padding: 10px;
      overflow-y: auto;
      background-color: #111;
    }
    #chat-box div {
      margin-bottom: 8px;
      padding: 6px;
      background: #222;
      border-radius: 5px;
    }
    #message-form {
      display: flex;
      padding: 10px;
      background-color: #1a1a1a;
    }
    #message-input {
      flex: 1;
      padding: 10px;
      border-radius: 4px;
      border: none;
      margin-right: 10px;
    }
    #send-button {
      background-color: #28a745;
      color: #fff;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 4px;
    }
    #login-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      background-color: #000;
    }
    #login-screen input, #login-screen button {
      margin: 8px;
      padding: 10px;
      width: 80%;
    }
  </style>
</head>
<body>
  <header>
    <h1>Miriele Chatroom</h1>
    <div>
      <button onclick="window.location.href='index.html'">Home</button>
      <button id="logout-button">Logout</button>
    </div>
  </header>

  <div id="login-screen">
    <input type="email" id="email" placeholder="Email" />
    <input type="password" id="password" placeholder="Password" />
    <button onclick="signIn()">Sign In</button>
    <button onclick="signUp()">Sign Up</button>
  </div>

  <div id="chat-container" style="display: none;">
    <div id="chat-box"></div>
    <form id="message-form" onsubmit="sendMessage(event)">
      <input id="message-input" placeholder="Type your message..." required />
      <button type="submit" id="send-button">Send</button>
    </form>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";
    import {
      getDatabase,
      ref,
      push,
      onChildAdded,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB4w6elulTE2FJbJVAXNUYs74_YC1Ti6yQ",
      authDomain: "mirielechat.firebaseapp.com",
      projectId: "mirielechat",
      storageBucket: "mirielechat.appspot.com",
      messagingSenderId: "1031331000258",
      appId: "1:1031331000258:web:7cae47f29cb3493fb1f05b",
      databaseURL: "https://mirielechat-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const loginScreen = document.getElementById('login-screen');
    const chatContainer = document.getElementById('chat-container');
    const logoutButton = document.getElementById('logout-button');

    onAuthStateChanged(auth, user => {
      if (user) {
        loginScreen.style.display = 'none';
        chatContainer.style.display = 'flex';
        loadChat();
      } else {
        loginScreen.style.display = 'flex';
        chatContainer.style.display = 'none';
      }
    });

    function signIn() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      signInWithEmailAndPassword(auth, email, password).catch(alert);
    }

    function signUp() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      createUserWithEmailAndPassword(auth, email, password).catch(alert);
    }

    logoutButton.addEventListener('click', () => {
      signOut(auth).catch(alert);
    });

    function loadChat() {
      const chatBox = document.getElementById('chat-box');
      const chatRef = ref(db, 'messages');

      onChildAdded(chatRef, snapshot => {
        const message = snapshot.val();
        const div = document.createElement('div');
        const time = new Date(message.timestamp || Date.now()).toLocaleTimeString();
        div.textContent = `[${time}] ${message.user || 'Anonymous'}: ${message.text}`;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
      });
    }

    function sendMessage(e) {
      e.preventDefault();
      const messageInput = document.getElementById('message-input');
      const text = messageInput.value.trim();
      if (!text) return;

      const chatRef = ref(db, 'messages');
      push(chatRef, {
        text,
        user: auth.currentUser.email,
        timestamp: Date.now()
      });

      messageInput.value = '';
    }
  </script>
</body>
</html>
